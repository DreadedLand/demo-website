"use strict";(()=>{var e={};e.id=87,e.ids=[87],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},470:e=>{e.exports=require("sql.js")},2048:e=>{e.exports=require("fs")},5315:e=>{e.exports=require("path")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},6044:(e,t,r)=>{r.r(t),r.d(t,{config:()=>l,default:()=>d,routeModule:()=>c});var s={};r.r(s),r.d(s,{default:()=>i});var n=r(1802),u=r(7153),a=r(6249),o=r(7837);async function i(e,t){let{slug:r}=e.query,s=await (0,o.getDb)();if("GET"===e.method){let e=`SELECT p.*, c.name as category_name, c.slug as category_slug FROM products p LEFT JOIN categories c ON p.category_id = c.id WHERE p.slug = '${r}'`,n=s.prepare(e),u=null;if(n.step()&&(u=n.getAsObject()),n.free(),!u)return t.status(404).json({error:"Product not found"});t.status(200).json(u)}else if("PUT"===e.method){let{name:n,description:u,price:a,stock:i,category_id:d,image_url:l,featured:c}=e.body,p=`UPDATE products SET name = '${n}', description = '${u}', price = ${a}, stock = ${i}, category_id = ${d}, image_url = '${l}', featured = ${c?1:0} WHERE slug = '${r}'`;try{s.run(p),(0,o.saveDb)(),t.status(200).json({message:"Product updated"})}catch(e){t.status(500).json({error:"Failed to update product"})}}else if("DELETE"===e.method){let e=`DELETE FROM products WHERE slug = '${r}'`;try{s.run(e),(0,o.saveDb)(),t.status(200).json({message:"Product deleted"})}catch(e){t.status(500).json({error:"Failed to delete product"})}}else t.setHeader("Allow",["GET","PUT","DELETE"]),t.status(405).end(`Method ${e.method} Not Allowed`)}let d=(0,a.l)(s,"default"),l=(0,a.l)(s,"config"),c=new n.PagesAPIRouteModule({definition:{kind:u.x.PAGES_API,page:"/api/products/[slug]",pathname:"/api/products/[slug]",bundlePath:"",filename:""},userland:s})},7837:(e,t,r)=>{let s=r(470),n=r(2048),u=r(5315).join(process.cwd(),"database.db"),a=null,o=null;async function i(){if(a)return a;if(o||(o=await s()),n.existsSync(u)){let e=n.readFileSync(u);a=new o.Database(e)}else a=new o.Database;return a}function d(){if(a){let e=a.export(),t=Buffer.from(e);n.writeFileSync(u,t)}}e.exports={getDb:i,saveDb:d,prepare:function(e,t){return{run:(...r)=>(e.run(t,r),d(),{lastInsertRowid:e.exec("SELECT last_insert_rowid()")[0]?.values[0][0]}),get:(...r)=>{let s=e.prepare(t);if(s.bind(r),s.step()){let e=s.getAsObject();return s.free(),e}s.free()},all:(...r)=>{let s=[],n=e.prepare(t);for(n.bind(r);n.step();)s.push(n.getAsObject());return n.free(),s}}}}},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=t(t.s=6044);module.exports=r})();