"use strict";(()=>{var e={};e.id=221,e.ids=[221],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},470:e=>{e.exports=require("sql.js")},2048:e=>{e.exports=require("fs")},5315:e=>{e.exports=require("path")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},1903:(e,t,r)=>{r.r(t),r.d(t,{config:()=>l,default:()=>d,routeModule:()=>c});var a={};r.r(a),r.d(a,{default:()=>u});var n=r(1802),s=r(7153),i=r(6249),o=r(7837);async function u(e,t){let r=await (0,o.getDb)();if("GET"===e.method){let{category:a,featured:n,search:s,limit:i}=e.query,o="SELECT p.*, c.name as category_name, c.slug as category_slug FROM products p LEFT JOIN categories c ON p.category_id = c.id WHERE 1=1";a&&(o+=` AND c.slug = '${a}'`),"true"===n&&(o+=" AND p.featured = 1"),s&&(o+=` AND (p.name LIKE '%${s}%' OR p.description LIKE '%${s}%')`),o+=" ORDER BY p.created_at DESC",i&&(o+=` LIMIT ${i}`);let u=[],d=r.prepare(o);for(;d.step();)u.push(d.getAsObject());d.free(),t.status(200).json(u)}else if("POST"===e.method){let{name:a,slug:n,description:s,price:i,stock:u,category_id:d,image_url:l,featured:c}=e.body,p=`INSERT INTO products (name, slug, description, price, stock, category_id, image_url, featured) VALUES ('${a}', '${n}', '${s}', ${i}, ${u}, ${d}, '${l}', ${c?1:0})`;try{r.run(p),(0,o.saveDb)();let e=r.exec("SELECT last_insert_rowid()")[0]?.values[0][0];t.status(201).json({id:e,message:"Product created"})}catch(e){t.status(500).json({error:"Failed to create product"})}}else t.setHeader("Allow",["GET","POST"]),t.status(405).end(`Method ${e.method} Not Allowed`)}let d=(0,i.l)(a,"default"),l=(0,i.l)(a,"config"),c=new n.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/products",pathname:"/api/products",bundlePath:"",filename:""},userland:a})},7837:(e,t,r)=>{let a=r(470),n=r(2048),s=r(5315).join(process.cwd(),"database.db"),i=null,o=null;async function u(){if(i)return i;if(o||(o=await a()),n.existsSync(s)){let e=n.readFileSync(s);i=new o.Database(e)}else i=new o.Database;return i}function d(){if(i){let e=i.export(),t=Buffer.from(e);n.writeFileSync(s,t)}}e.exports={getDb:u,saveDb:d,prepare:function(e,t){return{run:(...r)=>(e.run(t,r),d(),{lastInsertRowid:e.exec("SELECT last_insert_rowid()")[0]?.values[0][0]}),get:(...r)=>{let a=e.prepare(t);if(a.bind(r),a.step()){let e=a.getAsObject();return a.free(),e}a.free()},all:(...r)=>{let a=[],n=e.prepare(t);for(n.bind(r);n.step();)a.push(n.getAsObject());return n.free(),a}}}}},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=t(t.s=1903);module.exports=r})();